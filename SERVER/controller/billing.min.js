'use strict';"production"!==process.env.NODE_ENV&&require("dotenv").config();const stripe=require("stripe")(process.env.STRIPE_SECRET_KEY),express=require("express"),app=express(),router=express.Router(),User=require("../model/User");router.get("/*",(a,c,b)=>{a.app.locals.layout="index";b()});
router.post("/api/stripe",(a,c)=>{if(!a.user)return c.status(402).json({error:"Sign in to continue"});stripe.charges.create({amount:500,currency:"usd",description:"Subscription for 5 Email Credits",source:a.body.id},(b,f)=>{b&&console.log(b);User.findById(a.user._id).then(d=>{d.credit+=5;d.save();then(e=>{c.status(200).json({data:e})})})})});module.exports=router;